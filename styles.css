:root {
  --bg-start: #e0f7fa;
  --bg-end: #f5fcfd;
  --panel: #ffffff;
  --muted: #607d8b;
  --board: #b2ebf2;
  --cell-empty: #e0f2f1;
  --accent: #00bcd4;
  --accent-2: #3f51b5;
  --radius: 10px;
  --transition: 200ms cubic-bezier(.25,.9,.35,1.2);
  --grid-padding: 8px;
  --cell-gap: 12px;
  --grid-size: 4;
}
* { box-sizing: border-box; }
html, body {
  height: 100%; margin:0;
  font-family: 'Poppins', sans-serif, "Segoe UI", Roboto, Arial;
  background: linear-gradient(180deg,var(--bg-start),var(--bg-end));
  display:flex; justify-content:center; align-items:flex-start;
  padding:20px 10px; -webkit-font-smoothing:antialiased;
  font-weight:500; color:#212121;
  overscroll-behavior-y: contain;
}
.container { width:100%; max-width:460px; }
header { display:flex; justify-content:space-between; align-items:center; margin-bottom:14px; }
h1 { font-size:24px; margin:0; font-weight:700; letter-spacing:-0.5px; }
.stats { display:flex; gap:8px; align-items:center; }
.card {
  background:var(--panel); padding:8px 16px; border-radius:10px;
  box-shadow:0 4px 12px rgba(17,24,39,0.06);
  font-size:14px; min-width:90px; text-align:center; font-weight:600;
}
.board {
  background:var(--board); padding:var(--grid-padding); border-radius:16px;
  box-shadow:0 8px 30px rgba(17,24,39,0.08);
  position:relative;
}
.grid {
  position:relative;
  width:100%; max-width:400px; aspect-ratio:1/1;
  margin:0 auto;
  display:grid;
  grid-template-columns:repeat(var(--grid-size),1fr);
  gap:var(--cell-gap);
  padding:var(--cell-gap);
}
.bg-cell {
  background:var(--cell-empty);
  border-radius:var(--radius);
  box-shadow: inset 0 -2px 0 rgba(0,0,0,0.04), 0 1px 2px rgba(0,0,0,0.03);
  position:relative;
}
.tiles {
  position:absolute;
  inset:var(--grid-padding);
  display:block;
  pointer-events:none;
}
.tile {
  position:absolute;
  --cell-size: calc((100% - var(--cell-gap) * (var(--grid-size) - 1)) / var(--grid-size));
  width: var(--cell-size);
  height: var(--cell-size);
  border-radius:var(--radius);
  font-weight:800;
  font-size:32px;
  display:flex;
  align-items:center;
  justify-content:center;
  user-select:none;
  color:#fff;
  transform:translate(calc(var(--col) * (var(--cell-size) + var(--cell-gap))), calc(var(--row) * (var(--cell-size) + var(--cell-gap)))) scale(1);
  transition: transform var(--transition), background var(--transition), color var(--transition);
  will-change: transform;
  text-shadow:0 2px 4px rgba(0,0,0,0.3);
}
.tile.tile-new {
  animation: tilePopIn 260ms cubic-bezier(.25,1.4,.4,1);
}
.tile.tile-merged {
  animation: tilePulse 340ms cubic-bezier(.3,1.4,.35,1);
  z-index:5;
}
@keyframes tilePopIn {
  0% { transform:translate(calc(var(--col) * (var(--cell-size) + var(--cell-gap))), calc(var(--row) * (var(--cell-size) + var(--cell-gap)))) scale(.35); opacity:0; }
  55% { transform:translate(calc(var(--col) * (var(--cell-size) + var(--cell-gap))), calc(var(--row) * (var(--cell-size) + var(--cell-gap)))) scale(1.12); opacity:1; }
  100% { transform:translate(calc(var(--col) * (var(--cell-size) + var(--cell-gap))), calc(var(--row) * (var(--cell-size) + var(--cell-gap)))) scale(1); opacity:1; }
}
@keyframes tilePulse {
  0% { transform:translate(calc(var(--col) * (var(--cell-size) + var(--cell-gap))), calc(var(--row) * (var(--cell-size) + var(--cell-gap)))) scale(1); }
  45% { transform:translate(calc(var(--col) * (var(--cell-size) + var(--cell-gap))), calc(var(--row) * (var(--cell-size) + var(--cell-gap)))) scale(1.16); }
  100% { transform:translate(calc(var(--col) * (var(--cell-size) + var(--cell-gap))), calc(var(--row) * (var(--cell-size) + var(--cell-gap)))) scale(1); }
}
.t-2 {background:#eee4da;color:#776e65;}
.t-4 {background:#ede0c8;color:#776e65;}
.t-8 {background:#f2b179;}
.t-16 {background:#f59563;}
.t-32 {background:#f67c5f;}
.t-64 {background:#f65e3b;}
.t-128 {background:#edcf72; font-size:24px;}
.t-256 {background:#edcc61; font-size:24px;}
.t-512 {background:#edc850; font-size:22px;}
.t-1024 {background:#edc53f; font-size:20px;}
.t-2048 {background:#edc22e; font-size:18px;}
.t-large { }
.controls { display:flex; gap:10px; margin-top:16px; }
button {
  padding:10px 14px; border-radius:var(--radius); border:0; cursor:pointer;
  font-weight:700; font-size:14px;
  transition:transform .12s, box-shadow .12s;
}
button:active { transform:translateY(2px); box-shadow:none; }
#btnRestart, #btnRestart2 {
  background:var(--accent-2); color:#fff;
  box-shadow:0 4px 12px rgba(63,81,181,0.3);
}
.overlay {
  position:fixed; inset:0; display:none;
  align-items:center; justify-content:center;
  background:rgba(0,0,0,0.45); z-index:50;
  backdrop-filter:blur(5px);
}
.panel {
  background:var(--panel); padding:20px; border-radius:12px;
  min-width:300px; max-width:92%;
  box-shadow:0 12px 40px rgba(0,0,0,0.15);
  text-align:center;
}
.panel h2 { margin:0; font-size:22px; font-weight:700; }
.panel p { margin:10px 0 0; color:var(--muted); font-size:14px; }
.event-options {
  display:flex; flex-direction:column; gap:12px; margin-top:18px;
}
.event-option {
  background:#f8f9fa; padding:16px 16px 14px; border-radius:12px;
  border:1px solid #e3e7ee; cursor:pointer;
  transition: transform .12s, box-shadow .18s, background .25s, color .25s, border-color .25s;
  user-select:none; position:relative; overflow:hidden;
}
.event-option:before {
  content:""; position:absolute; inset:0;
  background:radial-gradient(circle at 30% 20%,rgba(255,255,255,0.35),transparent 70%);
  opacity:0; transition:opacity .4s; pointer-events:none;
}
.event-option:hover:before { opacity:1; }
.event-option:hover {
  transform:translateY(-2px);
  box-shadow:0 10px 24px -4px rgba(63,81,181,0.25);
  background:#ffffff;
}
.event-option strong {
  display:block; font-size:16px; letter-spacing:.5px; margin-bottom:4px;
  font-weight:700; color:#3f51b5;
}
.event-option div { font-size:12px; color:#607d8b; line-height:1.4; }
/* Chance */
.event-option.chance {
  border:1px solid #90caf9;
  background:linear-gradient(145deg,#e3f2fd,#ffffff);
}
.event-option.chance strong { color:#1976d2; }
.event-option.chance:hover {
  box-shadow:0 12px 28px -6px rgba(25,118,210,0.45);
  border-color:#64b5f6;
}
/* Fate */
.event-option.fate {
  border:1px solid #ef9a9a;
  background:linear-gradient(145deg,#ffebee,#ffe5e5);
}
.event-option.fate strong { color:#b71c1c; }
.event-option.fate:hover {
  box-shadow:0 14px 32px -4px rgba(183,28,28,0.55);
  border-color:#ef5350;
  background:linear-gradient(145deg,#ffcdd2,#ffe5e5);
}
#btnCloseEvent {
  margin-top:20px;
  background:#607d8b;
  color:#fff;
  border-radius:var(--radius);
  font-weight:600;
  box-shadow:0 4px 12px rgba(96,125,139,0.35);
}
#btnCloseEvent:hover { filter:brightness(1.05); }
#statusBar {
  margin-top:10px;
  font-size:14px;
  font-weight:700;
  min-height:20px;
  letter-spacing:.4px;
  color:#0d47a1;
  text-shadow:0 1px 2px rgba(0,0,0,0.15), 0 0 6px rgba(13,71,161,0.35);
  transition:color .4s;
}
@media (max-width:420px){
  .grid { gap:10px; padding: 10px; }
  :root { --cell-gap: 10px; }
  .panel { min-width:280px; }
  .tile { font-size:24px; }
}
